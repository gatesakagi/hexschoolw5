<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
	<title>hexschool-valid</title>
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
	<div class="wrap">
		<div class="itemfull">
			<div class="progressbar">
				<ul>
					<li><i class="fas fa-check-circle"></i></li>
					<li><i class="fas fa-check-circle"></i></li>
					<li><i class="fas fa-check-circle"></i></li>
					<li class="active"></li>
				</ul>
			</div>
		</div>
		<div class="itemfull">
			<p class="title">Payment Method</p>
			<p class="subtitle">Add your credit card infomation! </p>
		</div>
		<form id="step4form">
			<div class="itemfull">
				<label for="usercardnumber">Card Number</label>
				<input type="text" id="usercardnumber" name="usercardnumber" placeholder="1234 5678 9012 3456" class="cardnumberbox" required maxlength="19" title="請輸入正確的信用卡卡號" pattern="[ 0-9]{19}">
				<span class="usercard"><i></i></span>
			</div>
			<div class="itemhalf">
				<label for="usercardholdername">Cardhold Name</label>
				<input type="text" id="usercardholdername" name="usercardholdername" placeholder="EXAMPLE NAME" required>
			</div>
			<div class="itemhalf">
				<label for="userbankname">Bank Name</label>
				<input type="text" id="userbankname" name="userbankname" placeholder="EXAMPLE BANK" required>
			</div>
			<div class="itemthree">
				<label for="userCVV">CVV</label>
				<input type="text" id="userCVV" name="userCVV" placeholder="123" maxlength="3" required pattern="\d{3}">
			</div>
			<div class="itemthree select-wrapper">
				<label>Expire Date</label>
				<select id="expiredatemm" name="expiredatemm" required>
					<option disabled selected value>MM</option>
					<option value="1">01</option>
					<option value="2">02</option>
					<option value="3">03</option>
					<option value="4">04</option>
					<option value="5">05</option>
					<option value="6">06</option>
					<option value="7">07</option>
					<option value="8">08</option>
					<option value="9">09</option>
					<option value="10">10</option>
					<option value="11">11</option>
					<option value="12">12</option>
				</select>
			</div>
			<div class="itemthree select-wrapper nolabel">
				<select id="expiredateyy" name="expiredateyy" required placeholder="MM">
					<option disabled selected value>YY</option>
					<option value="18">18</option>
					<option value="19">19</option>
					<option value="20">20</option>
					<option value="21">21</option>
					<option value="22">22</option>
					<option value="23">23</option>
					<option value="24">24</option>
					<option value="25">25</option>
					<option value="26">26</option>
					<option value="27">27</option>
					<option value="28">28</option>
				</select>
			</div>
			<div class="itemfull">
				<button class="btnstep">DONE</button>
			</div>
		</form>
		<ul class="nav">
			<li><a href="step1.html">step1</a></li>
			<li><a href="step2.html">step2</a></li>
			<li><a href="step3.html">step3</a></li>
			<li class="active"><a href="step4.html">step4</a></li>
			<li><a href="step5.html">step5</a></li>
		</ul>
		<script src="https://code.jquery.com/jquery.js"></script>
		<script type="text/javascript" src="script.js"></script>
		<script>
			$('#usercardnumber').keyup(function() {
	            var val = $(this).val();
	            val = val.replace(/(\d{4})(?=\d)/g, "$1 ");
	            $(this).val(val);
	            var usercardFirstChar = val.charAt(0);
	           	if (val.length == 1) {
	           		checkVisaOrMaster(usercardFirstChar);
	           	} else if (val.length == 2) {
	           		if (parseInt(val) == 34 || parseInt(val) == 37) {
						$('.usercard i').removeClass().addClass('fab fa-cc-amex');
					} else {
						checkVisaOrMaster(usercardFirstChar);
					}
	           	} else if (val.length == 4) {
	           		if (parseInt(val) > 3527 && parseInt(val) < 3590) {
	           			$('.usercard i').removeClass().addClass('fab fa-cc-jcb');
	           		} else {
	           			if (parseInt(val.charAt(0)+val.charAt(1)) == 34 || parseInt(val.charAt(0)+val.charAt(1)) == 37) {
							$('.usercard i').removeClass().addClass('fab fa-cc-amex');
						} else {
							checkVisaOrMaster(usercardFirstChar);
						}
	           		}
	           	}
	        });
	        function checkVisaOrMaster(cardnum) {
	        	switch (cardnum) { 
					case '1': 
						$('.usercard i').removeClass().addClass('fab fa-cc-visa');
						break;
					case '2': 
						$('.usercard i').removeClass().addClass('fab fa-cc-mastercard');
						break;
					default:
						$('.usercard i').removeClass().addClass('far fa-credit-card');
				}
	        }
	        function optionColorChange($targetSelect) {
	        	if ($($targetSelect).val() == null ) {
	            	$($targetSelect).css('color', 'var(--placeholdercolor)');
	            } else {
	            	$($targetSelect).css('color', 'var(--graycolor)');
	            }
	        }
	        $('#expiredatemm').ready(function(){
	            optionColorChange($('#expiredatemm'));
	        });
	        $('#expiredatemm').change(function(){
	            optionColorChange($('#expiredatemm'));
	        });
	        $('#expiredateyy').ready(function(){
	            optionColorChange($('#expiredateyy'));
	        });
	        $('#expiredateyy').change(function(){
	            optionColorChange($('#expiredateyy'));
	        });

	        var validateCounts = 0;
	        var validcardnumberResult = false;
	        $('#usercardnumber').change(function(){
	        	if ($(this).val().length == 19) {
	        		var usercardnumberRegex = /[ 0-9]{19}/;
	        		validcardnumberResult = usercardnumberRegex.test($(this).val());
	        	} else {
	        		validcardnumberResult = false;
	        	}
	        		console.log(validcardnumberResult);
	        		validateCheck('#usercardnumber');
	        });
	        $('#usercardholdername').change(function(){
	        	validateCheck('#usercardholdername');
	        });
	        $('#userbankname').change(function(){
	        	validateCheck('#userbankname');
	        });
	        $('#userCVV').change(function(){
	        	validateCheck('#userCVV');
	        });
	        $('#expiredatemm').change(function(){
	        	validateCheck('#expiredatemm');
	        });
	        $('#expiredateyy').change(function(){
	        	validateCheck('#expiredateyy');
	        });
	        
	        function validateCheck(targetElementID) {
	        	if($(targetElementID).val() != '') {
	        		validateCounts++;
	        	}
	        	if (validateCounts > 5 && validcardnumberResult == true) {
	        		$('.btnstep').removeClass('active');
		    		$('.btnstep').addClass('active');
			    } else {
			    	$('.btnstep').removeClass('active');
			    }
	        }
    	</script>
	</div>
</body>
</html>